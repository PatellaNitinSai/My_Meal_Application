<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pick and Order</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        /* Navbar and Header */
        .navbar {
            background-color: #343a40;
        }

        #pick-and-order {
            font-size: 3rem;
            font-weight: bold;
            text-align: center;
            margin-top: 20px;
        }

        /* Spinner */
        #loadingSpinner {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 80vh;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            #pick-and-order {
                font-size: 2rem;
            }
        }

        @media (max-width: 480px) {
            #pick-and-order {
                font-size: 1.5rem;
            }
        }
    </style>
</head>

<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Pick and Order</a>
        </div>
    </nav>

    <!-- Header -->
    <header>
        <h1 id="pick-and-order">Pick and Order</h1>
    </header>

    <!-- Loading Spinner -->
    <div id="loadingSpinner">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container mt-4 d-none" id="mainContent">
        <!-- Search and Filter -->
        <div class="row mb-3">
            <div class="col-md-6">
                <input type="text" id="searchBox" class="form-control" placeholder="Search items" oninput="searchItems()">
            </div>
            <div class="col-md-6">
                <select id="filterDropdown" class="form-select" onchange="filterMenu()">
                    <option value="all">All</option>
                    <option value="veg">Veg</option>
                    <option value="non veg">Non-Veg</option>
                    <option value="drinks">Drinks</option>
                </select>
            </div>
        </div>

        <!-- Menu Items -->
        <div id="menuContainer" class="row">
            <!-- Dynamically Rendered Items -->
        </div>
    </div>

    <!-- Cart Button -->
    <button class="btn btn-success position-fixed bottom-0 end-0 m-4">
        <a href="OrderedItems.html" class="text-white">Cart Total: â‚¹<span id="cartTotal">0</span></a>
    </button>

    <!-- Footer -->
    <footer class="text-center mt-4">
        &copy; 2024 Pick and Order
    </footer>

    <script>
        const rupeeSymbol = '\u20B9';
        let total = 0;
        let menuData = [];
        let orderItems = [];

        const menuContainer = document.getElementById('menuContainer');
        const cartTotalSpan = document.getElementById('cartTotal');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const mainContent = document.getElementById('mainContent');

        const apiUrl = window.location.hostname === 'localhost'
            ? 'http://localhost:5000'
            : 'https://webapllication.onrender.com';

        // Fetch Menu Data
        function fetchMenuData() {
            axios.get(`${apiUrl}/menu/showVeg`)
                .then(response => {
                    menuData = response.data;
                    renderMenu(menuData);
                    loadingSpinner.classList.add('d-none'); // Hide Spinner
                    mainContent.classList.remove('d-none'); // Show Content
                })
                .catch(error => {
                    console.error('Error fetching menu:', error);
                    alert('Failed to load menu. Please try again later.');
                });
        }

        // Render Menu Items
        function renderMenu(data) {
            menuContainer.innerHTML = ''; // Clear Menu
            data.forEach(item => {
                const col = document.createElement('div');
                col.classList.add('col-md-4', 'mb-4');
                col.innerHTML = `
                    <div class="card h-100">
                        <div class="card-body">
                            <h5 class="card-title">${item.itemName}</h5>
                            <p class="card-text">${item.description}</p>
                            <p><strong>${rupeeSymbol}${item.price}</strong></p>
                            <div class="d-flex justify-content-between">
                                <button class="btn btn-success btn-sm add-item">+</button>
                                <span class="item-count">0</span>
                                <button class="btn btn-danger btn-sm remove-item" disabled>-</button>
                            </div>
                        </div>
                    </div>
                `;

                const addButton = col.querySelector('.add-item');
                const removeButton = col.querySelector('.remove-item');
                const itemCount = col.querySelector('.item-count');

                addButton.addEventListener('click', () => addItem(item, itemCount, removeButton));
                removeButton.addEventListener('click', () => removeItem(item, itemCount, removeButton));

                menuContainer.appendChild(col);
            });
        }

        // Add Item to Cart
        function addItem(item, itemCount, removeButton) {
            const count = parseInt(itemCount.textContent) + 1;
            itemCount.textContent = count;
            total += item.price;
            updateCartTotal();

            if (count > 0) removeButton.disabled = false;
            orderItems.push(item.itemName);
        }

        // Remove Item from Cart
        function removeItem(item, itemCount, removeButton) {
            const count = Math.max(0, parseInt(itemCount.textContent) - 1);
            itemCount.textContent = count;
            total = Math.max(0, total - item.price);
            updateCartTotal();

            if (count === 0) removeButton.disabled = true;
            const index = orderItems.indexOf(item.itemName);
            if (index !== -1) orderItems.splice(index, 1);
        }

        // Update Cart Total
        function updateCartTotal() {
            cartTotalSpan.textContent = total.toFixed(2);
        }

        // Search Items
        function searchItems() {
            const searchTerm = document.getElementById('searchBox').value.toLowerCase();
            const filteredItems = menuData.filter(item =>
                item.itemName.toLowerCase().includes(searchTerm)
            );
            renderMenu(filteredItems);
        }

        // Filter Menu
        function filterMenu() {
            const filterValue = document.getElementById('filterDropdown').value;
            const filteredItems =
                filterValue === 'all'
                    ? menuData
                    : menuData.filter(item => item.category.toLowerCase() === filterValue.toLowerCase());
            renderMenu(filteredItems);
        }

        // Initialize Fetch
        fetchMenuData();
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>
